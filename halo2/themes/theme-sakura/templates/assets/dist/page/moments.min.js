import{d as y,s as g}from"../main.min.js";import"../assets/_commonjsHelpers-042e6b4d.js";class C{static async like(o,t,e){const n=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:o,plural:t,name:e})});if(n.status!==200){console.error("点赞失败，请求异常");return}return n}}var M=Object.defineProperty,k=Object.getOwnPropertyDescriptor,L=(l,o,t,e)=>{for(var n=e>1?void 0:e?k(o,t):o,r=l.length-1,i;r>=0;r--)(i=l[r])&&(n=(e?i(o,t,n):i(n))||n);return e&&n&&M(o,t,n),n};class S{registerMomentListPagination(){const o=document.getElementById("moment-list-pagination");if(!o)return;const t=o.querySelector("a");t&&t.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector(".moments-container .moments-inner");if(!n)return;const r=e.target,i=r.href;r.classList.add("loading"),r.textContent="",fetch(i,{method:"GET"}).then(m=>m.text()).then(m=>{const p=new DOMParser().parseFromString(m,"text/html"),c=p.querySelector(".moments-container .moments-inner");if(c){this.registerMomentItem(c);const u=c.querySelectorAll(".moments-item");u&&u.length>0&&u.forEach(h=>{n.appendChild(h);const s=h.querySelector(".comment-box .comment script:last-of-type"),v=(s==null?void 0:s.text)||(s==null?void 0:s.textContent)||(s==null?void 0:s.innerHTML)||"",a=s.parentNode;a==null||a.removeChild(s);const d=document.createElement("script");d.type="text/javascript",d.appendChild(document.createTextNode(v)),a==null||a.appendChild(d)})}const f=p.querySelector("#moment-list-pagination a");f?r.href=f.href:o.innerHTML=""}).catch(m=>{console.error(m)}).finally(()=>{r.classList.remove("loading"),r.textContent=g.translate("page.moments.loadmore","加载更多..."),g.$localize&&g.$localize(".moments-inner")})})}registerMomentItem(o){const t=o||document.querySelector(".moments-container .moments-inner");if(!t)return;const e=t==null?void 0:t.querySelectorAll(".moments-item");!e||e.length<=0||e.forEach(n=>{this.registerMomentItemLike(n),this.registerMomentItemComment(n)})}registerMomentItemLike(o){const t=JSON.parse(localStorage.getItem("momentlikedIds")||"[]"),e=o.querySelector(".moment-tools .moment-like");if(!e)return;const n=o.getAttribute("data-name")||"";if(t&&(t!=null&&t.includes(n))){e.classList.add("on");return}e.addEventListener("click",()=>{let r=Number(e.getAttribute("data-links")||"0");C.like("moment.halo.run","moments",n).then(()=>{r+=1,t.push(n),e.classList.add("on"),e.setAttribute("data-links",r.toString());const i=e.querySelector(".moment-like-text");i&&(i.textContent=r.toString()),localStorage.setItem("momentlikedIds",JSON.stringify(t))})},{once:!0})}registerMomentItemComment(o){const t=o.querySelector(".moment-tools .comment-js");t&&t.addEventListener("click",()=>{const e=o.querySelector(".comment-box");e==null||e.classList.toggle("is-show")})}}L([y()],S.prototype,"registerMomentListPagination",1);L([y()],S.prototype,"registerMomentItem",1);
