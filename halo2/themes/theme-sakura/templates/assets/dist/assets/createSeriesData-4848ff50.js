import{V as U,p as L,g as O,h as Q,f as K,o as k,n as X,d as Y,l as $,q as J}from"./graphic-083f2b2f.js";import{aN as I,aO as Z,aP as ee,aQ as ae,aR as ne,aS as ie,aT as W,aU as re,aV as oe,aW as te,aX as se,aY as le,aZ as G,a_ as q,a$ as fe,e as de,aI as ce,b0 as ue,b1 as ve,b2 as me}from"./Axis-b5ea7d9c.js";function Ee(a,e){return z(a,e).dimensions}function z(a,e){I(a)||(a=Z(a)),e=e||{};var o=e.coordDimensions||[],n=e.dimensionsDefine||a.dimensionsDefine||[],r=U(),i=[],s=De(a,o,n,e.dimensionsCount),u=e.canOmitUnusedDimensions&&ee(s),c=n===a.dimensionsDefine,p=c?ae(a):ne(n),C=e.encodeDefine;!C&&e.encodeDefaulter&&(C=e.encodeDefaulter(a,s));for(var h=U(C),x=new ie(s),g=0;g<x.length;g++)x[g]=-1;function M(l){var f=x[l];if(f<0){var d=n[l],m=k(d)?d:{name:d},t=new le,S=m.name;S!=null&&p.get(S)!=null&&(t.name=t.displayName=S),m.type!=null&&(t.type=m.type),m.displayName!=null&&(t.displayName=m.displayName);var v=i.length;return x[l]=v,t.storeDimIndex=l,i.push(t),t}return i[f]}if(!u)for(var g=0;g<s;g++)M(g);h.each(function(l,f){var d=W(l).slice();if(d.length===1&&!L(d[0])&&d[0]<0){h.set(f,!1);return}var m=h.set(f,[]);O(d,function(t,S){var v=L(t)?p.get(t):t;v!=null&&v<s&&(m[S]=v,T(M(v),f,S))})});var D=0;O(o,function(l){var f,d,m,t;if(L(l))f=l,t={};else{t=l,f=t.name;var S=t.ordinalMeta;t.ordinalMeta=null,t=Q({},t),t.ordinalMeta=S,d=t.dimsDef,m=t.otherDims,t.name=t.coordDim=t.coordDimIndex=t.dimsDef=t.otherDims=null}var v=h.get(f);if(v!==!1){if(v=W(v),!v.length)for(var B=0;B<(d&&d.length||1);B++){for(;D<s&&M(D).coordDim!=null;)D++;D<s&&v.push(D++)}O(v,function(P,j){var N=M(P);if(c&&t.type!=null&&(N.type=t.type),T(K(N,t),f,j),N.name==null&&d){var R=d[j];!k(R)&&(R={name:R}),N.name=N.displayName=R.name,N.defaultTooltip=R.defaultTooltip}m&&K(N.otherDims,m)})}});function T(l,f,d){re.get(f)!=null?l.otherDims[f]=d:(l.coordDim=f,l.coordDimIndex=d,r.set(f,!0))}var F=e.generateCoord,A=e.generateCoordCount,V=A!=null;A=F?A||1:0;var _=F||"value";function w(l){l.name==null&&(l.name=l.coordDim)}if(u)O(i,function(l){w(l)}),i.sort(function(l,f){return l.storeDimIndex-f.storeDimIndex});else for(var b=0;b<s;b++){var y=M(b),H=y.coordDim;H==null&&(y.coordDim=ye(_,r,V),y.coordDimIndex=0,(!F||A<=0)&&(y.isExtraCoord=!0),A--),w(y),y.type==null&&(oe(a,b)===te.Must||y.isExtraCoord&&(y.otherDims.itemName!=null||y.otherDims.seriesName!=null))&&(y.type="ordinal")}return ge(i),new se({source:a,dimensions:i,fullDimensionCount:s,dimensionOmitted:u})}function ge(a){for(var e=U(),o=0;o<a.length;o++){var n=a[o],r=n.name,i=e.get(r)||0;i>0&&(n.name=r+(i-1)),i++,e.set(r,i)}}function De(a,e,o,n){var r=Math.max(a.dimensionsDetectedCount||1,e.length,o.length,n||0);return O(e,function(i){var s;k(i)&&(s=i.dimsDef)&&(r=Math.max(r,s.length))}),r}function ye(a,e,o){if(o||e.hasKey(a)){for(var n=0;e.hasKey(a+n);)n++;a+=n}return e.set(a,!0),a}var he=function(){function a(e){this.coordSysDims=[],this.axisMap=U(),this.categoryAxisMap=U(),this.coordSysName=e}return a}();function pe(a){var e=a.get("coordinateSystem"),o=new he(e),n=Ce[e];if(n)return n(a,o,o.axisMap,o.categoryAxisMap),o}var Ce={cartesian2d:function(a,e,o,n){var r=a.getReferringComponents("xAxis",G).models[0],i=a.getReferringComponents("yAxis",G).models[0];e.coordSysDims=["x","y"],o.set("x",r),o.set("y",i),E(r)&&(n.set("x",r),e.firstCategoryDimIndex=0),E(i)&&(n.set("y",i),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(a,e,o,n){var r=a.getReferringComponents("singleAxis",G).models[0];e.coordSysDims=["single"],o.set("single",r),E(r)&&(n.set("single",r),e.firstCategoryDimIndex=0)},polar:function(a,e,o,n){var r=a.getReferringComponents("polar",G).models[0],i=r.findAxisModel("radiusAxis"),s=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],o.set("radius",i),o.set("angle",s),E(i)&&(n.set("radius",i),e.firstCategoryDimIndex=0),E(s)&&(n.set("angle",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(a,e,o,n){e.coordSysDims=["lng","lat"]},parallel:function(a,e,o,n){var r=a.ecModel,i=r.getComponent("parallel",a.get("parallelIndex")),s=e.coordSysDims=i.dimensions.slice();O(i.parallelAxisIndex,function(u,c){var p=r.getComponent("parallelAxis",u),C=s[c];o.set(C,p),E(p)&&(n.set(C,p),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=c))})}};function E(a){return a.get("type")==="category"}function Se(a,e){var o=a.get("coordinateSystem"),n=ve.get(o),r;return e&&e.coordSysDims&&(r=J(e.coordSysDims,function(i){var s={name:i},u=e.axisMap.get(i);if(u){var c=u.get("type");s.type=me(c)}return s})),r||(r=n&&(n.getDimensionsInfo?n.getDimensionsInfo():n.dimensions.slice())||["x","y"]),r}function xe(a,e,o){var n,r;return o&&O(a,function(i,s){var u=i.coordDim,c=o.categoryAxisMap.get(u);c&&(n==null&&(n=s),i.ordinalMeta=c.getOrdinalMeta(),e&&(i.createInvertedIndices=!0)),i.otherDims.itemName!=null&&(r=!0)}),!r&&n!=null&&(a[n].otherDims.itemName=0),n}function Fe(a,e,o){o=o||{};var n=e.getSourceManager(),r,i=!1;a?(i=!0,r=Z(a)):(r=n.getSource(),i=r.sourceFormat===q);var s=pe(e),u=Se(e,s),c=o.useEncodeDefaulter,p=X(c)?c:c?Y(fe,u,e):null,C={coordDimensions:u,generateCoord:o.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:p,canOmitUnusedDimensions:!i},h=z(r,C),x=xe(h.dimensions,o.createInvertedIndices,s),g=i?null:n.getSharedDataStore(h),M=de(e,{schema:h,store:g}),D=new ce(h,e);D.setCalculationInfo(M);var T=x!=null&&Me(r)?function(F,A,V,_){return _===x?V:this.defaultDimValueGetter(F,A,V,_)}:null;return D.hasItemOption=!1,D.initData(i?r:g,null,T),D}function Me(a){if(a.sourceFormat===q){var e=Ae(a.data||[]);return!$(ue(e))}}function Ae(a){for(var e=0;e<a.length&&a[e]==null;)e++;return a[e]}export{Ee as a,Fe as c,z as p};
